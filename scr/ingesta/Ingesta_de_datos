import pymysql
import os
from dotenv import load_dotenv
from sklearn.datasets import fetch_openml
import pandas as pd

load_dotenv()

def ingesta():
  """
  ingesta de datos desde origen para emepzar a trabajar con ellos
  1. leer los datos desde la fuente
  2. procesar los datos (limpieza, transformacion, etc)
  3. escribir los datos en la base de datos
  """

  source = fetch_openml(data_id=42813, as_frame=True)
  data = pd.DataFrame(source.data)
  
  return data

# def outliers(data):

# def duplicados(data):

# def nulos(data):


def escritura(dataset):
  timeout = 10
  connection = pymysql.connect(
    charset="utf8mb4",
    connect_timeout=timeout,
    cursorclass=pymysql.cursors.DictCursor,
    db=os.getenv("db"),
    host=os.getenv("host"),
    password=os.getenv("password"),
    read_timeout=timeout,
    port=int(os.getenv("port")),
    user=os.getenv("user"),
    write_timeout=timeout,
  )

  dataset.to_sql(
      name="BancoX",
      con=connection,    
      if_exists="append",
      index=False,       
      chunksize=1000,    
      method="multi"     # agrupa inserts -> menos round-trips
  )
  connection.close()